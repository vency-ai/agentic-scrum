apiVersion: batch/v1
kind: Job
metadata:
  name: sprint-setup-job
  namespace: dsm
spec:
  template:
    spec:
      serviceAccountName: default
      containers:
      - name: sprint-setup
        image: python:3.10
        command: ["/bin/sh", "-c", "pip install -r /app/requirements.txt && python /app/app.py"]
        envFrom:
        - secretRef:
            name: postgres-sprint-secret
        env:
        - name: PROJECT_SERVICE_URL
          value: "http://project-service:80"
        - name: BACKLOG_SERVICE_URL
          value: "http://backlog-service:80"
        - name: TEST_PROJECT_ID
          value: "TEST-001"
        - name: TEST_SPRINT_PREFIX
          value: "SPRINT"
        volumeMounts:
        - name: app-code
          mountPath: /app/app.py
          subPath: app.py
        - name: app-requirements
          mountPath: /app/requirements.txt
          subPath: requirements.txt
      restartPolicy: Never
      volumes:
      - name: app-code
        configMap:
          name: sprint-setup-code-cm
      - name: app-requirements
        configMap:
          name: sprint-setup-requirements-cm
